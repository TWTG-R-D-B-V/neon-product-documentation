## Online configurator

The device is configurable over LoRaWAN. To help generate a configuration, our [NEON Configurator](https://neon-configurator.twtg.io/neon/tt/v2/) can be used. This configurator is an online form with all possible settings within their allowed ranges. After tailoring the settings to your application you can then generate a LoRaWAN message to be sent via your network server.

## Conversion examples

The examples below are generated using the Javascript files in the example folder using [nodejs](https://nodejs.org/) (a Linux application to execute Javascript files).

### Encoding protocol v2

Generated by:
```
nodejs ./examples/encoder-tt-examples.js
```

### Device config message (EU868)
JSON:
```
{
    "header": {
        "message_type": "device_configuration",
        "protocol_version": 2
    },
    "switch_mask": {
        "enable_confirmed_event_message": true,
        "enable_rtd": false
    },
    "communication_max_retries": 3,
    "unconfirmed_repeat": 2,
    "periodic_message_random_delay_seconds": 60,
    "status_message_interval_seconds": 86400,
    "status_message_confirmed_interval": 1,
    "lora_failure_holdoff_count": 2,
    "lora_system_recover_count": 1,
    "lorawan_fsb_mask": [
        0,
        0,
        0,
        0,
        0
    ]
}
```
Bytestring (hexidecimal):
```
250103023ca00501020100000000000000000000d455
```
### Device config message (US915)
JSON:
```
{
    "header": {
        "message_type": "device_configuration",
        "protocol_version": 2
    },
    "switch_mask": {
        "enable_confirmed_event_message": true,
        "enable_rtd": false
    },
    "communication_max_retries": 3,
    "unconfirmed_repeat": 2,
    "periodic_message_random_delay_seconds": 60,
    "status_message_interval_seconds": 86400,
    "status_message_confirmed_interval": 1,
    "lora_failure_holdoff_count": 2,
    "lora_system_recover_count": 1,
    "lorawan_fsb_mask": [
        255,
        0,
        0,
        0,
        2
    ]
}
```
Bytestring (hexidecimal):
```
250103023ca005010201ff00000000000000020042e0
```
### Application config message
JSON:
```
{
    "header": {
        "message_type": "application_configuration",
        "protocol_version": 2
    },
    "device_type": "tt",
    "temperature_measurement_interval_seconds": 900,
    "periodic_event_message_interval": 16,
    "events": [
        {
            "mode": "off",
            "threshold_temperature": 0,
            "measurement_window": 0
        },
        {
            "mode": "off",
            "threshold_temperature": 0,
            "measurement_window": 0
        },
        {
            "mode": "off",
            "threshold_temperature": 0,
            "measurement_window": 0
        },
        {
            "mode": "off",
            "threshold_temperature": 0,
            "measurement_window": 0
        }
    ]
}
```
Bytestring (hexidecimal):
```
260484031000000000000000000000000000000000000b4f
```
### Application config message (pattern)
JSON:
```
{
    "header": {
        "message_type": "application_configuration",
        "protocol_version": 2
    },
    "device_type": "tt",
    "enable_rtd": false,
    "temperature_measurement_interval_seconds": 1,
    "periodic_event_message_interval": 2,
    "events": [
        {
            "mode": "above",
            "threshold_temperature": 0.03,
            "measurement_window": 7
        },
        {
            "mode": "below",
            "threshold_temperature": 0.04,
            "measurement_window": 8
        },
        {
            "mode": "increasing",
            "threshold_temperature": 0.05,
            "measurement_window": 9
        },
        {
            "mode": "decreasing",
            "threshold_temperature": 0.06,
            "measurement_window": 10
        }
    ]
}
```
Bytestring (hexidecimal):
```
2604010002000100000702000008030000090400000a9fde
```

### Decoding TT protocol v2

Generated by:
```
nodejs ./examples/decoder-tt-examples.js
```

#### Boot message
Bytestring (hexidecimal):
```
2004443322110100020003040610203040506070800708
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "boot"
    },
    "boot": {
        "device_type": "tt",
        "version_hash": "0x11223344",
        "device_config_crc": "0x0001",
        "application_config_crc": "0x0002",
        "reset_flags": "0x03",
        "reboot_counter": 4,
        "reboot_info": "unknown (0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80)",
        "last_device_state": 7,
        "bist": "0x08"
    }
}
```
#### Activated message
Bytestring (hexidecimal):
```
21
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "activated"
    }
}
```
#### Deactivated message
Bytestring (hexidecimal):
```
22
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "deactivated"
    }
}
```
#### Application event message (pattern 1)
Bytestring (hexidecimal):
```
230102000300040005
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "application_event"
    },
    "application_event": {
        "trigger": "condition_0",
        "temperature": {
            "min": 0.2,
            "max": 0.3,
            "avg": 0.4
        },
        "condition_0": 1,
        "condition_1": 0,
        "condition_2": 1,
        "condition_3": 0
    }
}
```
#### Application event message (pattern 2)
Bytestring (hexidecimal):
```
230474f54448d70009
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "application_event"
    },
    "application_event": {
        "trigger": "condition_3",
        "temperature": {
            "min": -270,
            "max": 1850,
            "avg": 21.5
        },
        "condition_0": 1,
        "condition_1": 0,
        "condition_2": 0,
        "condition_3": 1
    }
}
```
#### Device status message (pattern 1)
Bytestring (hexidecimal):
```
24cdab3412030b000c000d00151617060708
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "device_status"
    },
    "device_status": {
        "device_config_crc": "0xABCD",
        "application_config_crc": "0x1234",
        "event_counter": 3,
        "battery_voltage": {
            "low": 0.011,
            "high": 0.012,
            "settle": 0.013
        },
        "temperature": {
            "min": 21,
            "max": 22,
            "avg": 23
        },
        "tx_counter": 6,
        "avg_rssi": -7,
        "avg_snr": 8
    }
}
```
#### Device status message (pattern 2)
Bytestring (hexidecimal):
```
243412cdabffa00f100e5e0ed850157b4bf6
```
JSON:
```
{
    "header": {
        "protocol_version": 2,
        "message_type": "device_status"
    },
    "device_status": {
        "device_config_crc": "0x1234",
        "application_config_crc": "0xABCD",
        "event_counter": 255,
        "battery_voltage": {
            "low": 4,
            "high": 3.6,
            "settle": 3.678
        },
        "temperature": {
            "min": -40,
            "max": 80,
            "avg": 21
        },
        "tx_counter": 123,
        "avg_rssi": -75,
        "avg_snr": -10
    }
}
```
